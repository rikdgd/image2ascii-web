<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>image2ascii</title>
        <link rel="stylesheet" href="./styles.css"/>
    </head>
    <body>
        <div id="image-container">
            Hello world!
        </div>
        <div class="form-container">
            <label for="image-input">upload image:</label>
            <input id="image-input" type="file"/>
            <button id="convert-button">convert!</button>
        </div>
        
        <script type="module">
            import init, { greet, convert_image } from './pkg/image2ascii_web.js';
            init().then(() => {
                document.getElementById('convert-button').addEventListener('click', () => {
                    const imgInput = document.getElementById('image-input');
                    const imgFile = imgInput.files[0];

                    if (imgFile) {
                        const img = new Image();
                        img.onload = () => {
                            console.log('Successfully loaded image data, converting to ASCII...');
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                const arrayBuffer = event.target.result;
                                const uint8Array = new Uint8Array(arrayBuffer);
                                const htmlImage = convert_image(uint8Array, img.width, img.height);

                                if (htmlImage) {
                                    document.getElementById('image-container').innerHTML = htmlImage;
                                }
                            };

                            reader.onerror = (error) => {
                                console.error('Error reading file: ', error);
                            };

                            reader.readAsArrayBuffer(imgFile);
                        };

                        img.src = URL.createObjectURL(imgFile);
                    }
                });
            });
        </script>
    </body>
</html>